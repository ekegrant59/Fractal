<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Fractal Equities</title>
    <%- include('partials/headlinks') %>
</head>
<body>
    <%- include('partials/usernav') %>
    <%- include('partials/tradingview') %>
     <main class="px-md-5" data-bs-theme="dark">
        
        <div class="px-xl-5 pt-4">
            <div class="px-xl-5 px-3">
                <div class="rounded-4">
                    
                </div>
                <div class="px-md-4 px-3 py-3 mt-4 rounded-3 text-light bg-secondary bg-opacity-25" >
                    
                    <p class="fs-6 mb-0 font-poppins" style="font-weight: 500;">Glad to see you again! , <span class="fw-bold color1"><%= user.firstName %></span></p>
                    
                    <div class="d-flex justify-content-between pt-2">
                        <div>
                            <p class="fw-bold mb-0">Available Balance</p>
                            <p class="fs-1 fw-bold mb-0 color1">
                                <% if (Number.isInteger(user1.balance)){ %>
                                    $<span><%= user1.balance %>.00</span>
                                <% } else{ %>
                                    $<span><%= user1.balance %></span>
                                <% } %>
                            </p>
                        </div>
    
                        <div class="d-flex justify-content-between align-items-center overflow-x-auto ms-3">
                            <p class="mb-0 mx-2"><a href="/dashboard/deposit" class="btn btn3 font-poppins">Deposit</a></p>
                            <p class="mb-0 mx-2"><a href="/dashboard/trade" class="btn btn3 font-poppins">Trade</a></p>
                            <p class="mb-0 mx-2"><a href="/dashboard/withdraw" class="btn btn3 font-poppins">Withdraw</a></p>                            
                        </div>
                    </div>
                </div>
                <div class="container-fluid my-3 px-4">
                    <div class="row gx-3 gy-3">
                        <div class="col-6 col-md-3 h-100">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-4 py-3">
                                <div class="rounded-3 text-light bg-primary fs-5 px-3 py-1 mb-3" style="width: min-content;">
                                    <i class="fa-solid fa-sack-dollar"></i>
                                </div>
                                <p class="mb-0">Total Deposit</p>
                                <p class="fw-bold fs-4 mb-0 pb-1">
                                    <% if (Number.isInteger(user1.deposit)){ %>
                                        $<span><%= user1.deposit %>.00</span>
                                    <% } else{ %>
                                        $<span><%= user1.deposit %></span>
                                    <% } %>
                                </p>
                                    

                            </div>
                        </div>
                        <div class="col-6 col-md-3 h-100">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-4 py-3">
                                <div class="rounded-3 text-light bg-success fs-5 px-3 py-1 mb-3" style="width: min-content;">
                                    <i class="fa-solid fa-dollar-sign"></i>
                                </div>
                                <p class="mb-0">Total Profit</p>
                                <p class="fw-bold fs-4 mb-0 pb-1">
                                    <% if (Number.isInteger(user1.profit)){ %>
                                        $<span><%= user1.profit %>.00</span>
                                    <% } else{ %>
                                        $<span><%= user1.profit %></span>
                                    <% } %>
                                </p>

                            </div>
                        </div>
                        <div class="col-6 col-md-3 h-100">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-4 py-3">
                                <div class="rounded-3 text-light bg-danger fs-5 px-3 py-1 mb-3" style="width: min-content;">
                                    <i class="fa-solid fa-coins"></i>
                                </div>
                                <p class="mb-0">Total Withdrawal</p>
                                <p class="fw-bold fs-4 mb-0 pb-1">
                                    <% if (Number.isInteger(user1.withdrawal)){ %>
                                        $<span><%= user1.withdrawal %>.00</span>
                                    <% } else{ %>
                                        $<span><%= user1.withdrawal %></span>
                                    <% } %>
                                </p>

                            </div>
                        </div>
                        <div class="col-6 col-md-3 h-100">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-4 py-3">
                                <div class="rounded-3 text-light bg-info fs-5 px-3 py-1 mb-3" style="width: min-content;">
                                    <i class="fa-solid fa-gift"></i>
                                </div>
                                <p class="mb-0">Referall Bonus</p>
                                <p class="fw-bold fs-4 mb-0 pb-1">
                                    <% if (Number.isInteger(user1.bonus)){ %>
                                        $<span><%= user1.bonus %>.00</span>
                                    <% } else{ %>
                                        $<span><%= user1.bonus %></span>
                                    <% } %>
                                </p>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid my-5 px-0">
                    <div class="row gy-5 gx-3">
                        <div class="col-12 col-lg-8">
                            <div class="w-90 ms-0 h-100 bg-secondary text-light bg-opacity-25 rounded-3 px-4 pt-3">
                                <div class="d-flex justify-content-between">
                                    <p class="fw-semibold fs-5">Chart Overview</p>
                                    <p class="bg-light text-dark rounded-pill px-3 py-1">#BTCUSD</p>
                                </div>
                                <div style="height: 500px;">
                                    <!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container" style="height:100%;width:100%">
    <div class="tradingview-widget-container__widget" style="height:calc(100% - 20px);width:100%"></div>
    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"></a></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
    {
    "autosize": true,
    "symbol": "BITSTAMP:BTCUSD",
    "interval": "D",
    "timezone": "Etc/UTC",
    "theme": "dark",
    "style": "1",
    "locale": "en",
    "enable_publishing": false,
    "allow_symbol_change": true,
    "support_host": "https://www.tradingview.com"
  }
    </script>
  </div>
  <!-- TradingView Widget END -->
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-4 pt-3">
                                <p class="fw-semibold fs-5">Latest Updates</p>
                                <div style="height: 500px;">
                                    <!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"></a></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
    {
    "feedMode": "all_symbols",
    "isTransparent": false,
    "displayMode": "regular",
    "width": "100%",
    "height": "100%",
    "colorTheme": "dark",
    "locale": "en"
  }
    </script>
  </div>
  <!-- TradingView Widget END -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container-fluid pb-5 px-0">
                    <div class="row gx-3 gy-5">
                        <div class="col-12 col-lg-8">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-4 py-3">
                                <p class="fs-5 fw-bold">Recent Transactions</p>
                                <div>
                                    <span class="px-3 py-2 history fw-semibold deposit"><i class="fa-solid fa-circle-down px-2"></i>Deposits</span>
                                    <span class="px-3 py-2 history-none fw-semibold withdrawal"> <i class="fa-solid fa-circle-up px-2"></i>Withdrawals</span>
                                    <div class="transaction mt-4 py-2 overflow-x-auto">
                                        <div class="myhistory1 text-center">
                                            <div class="row myhistory text-center border border-1 rounded-1 border-secondary-subtle">
                                                <div class="col">Amount</div>
                                                <div class="col">Status</div>
                                                <div class="col">Currency</div>
                                                <div class="col">Date</div>
                                            </div>
                                            <div class="thehistory py-2">
                                                <% if (deposits.length > 0) { %>
                                                    <div class="container-fluid">
                                                        <% deposits.forEach(deposit =>{ %>
                                                            <div class="row text-center w-100 py-1">
                                                                <div class="col text-nowrap overflow-x-auto"><b>$<%= deposit.amount %> </b></div>
                                                                <div class="col text-nowrap overflow-x-auto"> 
                                                                    <% if (deposit.status == 'Pending'){%>
                                                                        <b class="text-warning"><%= deposit.status %> </b>
                                                                    <% }else{ %>
                                                                        <b class="text-success"><%= deposit.status %> </b>
                                                                    <% } %>
                                                                </div>
                                                                <div class="col text-nowrap overflow-x-auto"><b><%= deposit.coin %> </b></div>
                                                                
                                                                <div class="col text-nowrap overflow-x-auto"><b><%= deposit.date %> </b></div>
                                                            </div>
                                                        <% }) %> 
                                                    </div>
                                                <% } else { %>
                                                    <div class="text-center">
                                                        <p class="mb-0">No Transactions found.....</p>
                                                    </div>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <a href="/dashboard/history" class="btn btn-outline-warning px-3 py-1">View All</a>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4">
                            <div class="w-90 mx-auto bg-secondary bg-opacity-25 rounded-3 px-3 py-3">
                                <p class="fs-5 fw-bold">Refer Friends to Earn Commisions</p>
                                <p class="fw-light">Increase your commissions by inviting your friends to make deposits.</p>
                                <p><input class="form-control ref" type="text" value="https://fractalequities.com/invite/<%= user.username %>" aria-label="readonly input example" readonly></p>
                                <button type="button" class="btn btn-warning copy"
                                        style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .75rem; --bs-btn-font-size: 1rem;">
                                COPY
                                </button>
                                <p class="fw-semibold mb-0 pt-2">You have <%= referrals.length %> referrals  </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
        let copy = document.querySelector('.copy')
        let ref = document.querySelector('.ref')
        let myhistory = document.querySelector('.myhistory')
        copy.addEventListener('click', (e)=>{
            // e.preventDefault()
            navigator.clipboard.writeText(ref.value)
            copy.innerHTML = 'COPIED!'
        })

        let deposit = document.querySelector('.deposit')
        let withdrawal = document.querySelector('.withdrawal')
        let thehistory= document.querySelector('.thehistory')

        deposit.addEventListener('click', (e)=>{
            deposit.classList.remove('history-none')
            deposit.classList.add('history')
            withdrawal.classList.remove('history')
            withdrawal.classList.add('history-none')
            myhistory.innerHTML = `
            <div class="col">Amount</div>
            <div class="col">Currency</div>
            <div class="col">Status</div>
            <div class="col">Date</div>
            `

            thehistory.innerHTML = `<% if (deposits.length > 0) { %>
                                    <div class="container-fluid">
                                        <% deposits.forEach(deposit =>{ %>
                                            <div class="row text-center w-100 py-1">
                                                <div class="col text-nowrap overflow-x-auto"><b>$<%= deposit.amount %> </b></div>
                                                <div class="col text-nowrap overflow-x-auto"><b><%= deposit.coin %> </b></div>
                                                <div class="col text-nowrap overflow-x-auto"> 
                                                    <% if (deposit.status == 'Pending'){%>
                                                        <b class="text-warning"><%= deposit.status %> </b>
                                                    <% }else{ %>
                                                        <b class="text-success"><%= deposit.status %> </b>
                                                    <% } %>
                                                </div>
                                                <div class="col text-nowrap overflow-x-auto"><b><%= deposit.date %> </b></div>
                                            </div>
                                        <% }) %> 
                                    </div>
                                <% } else { %>
                                    <div class="text-center">
                                        <p class="mb-0">No Transactions found.....</p>
                                    </div>
                                <% } %>
            
            `
        })

        withdrawal.addEventListener('click', (e)=>{
            withdrawal.classList.remove('history-none')
            withdrawal.classList.add('history')
            deposit.classList.remove('history')
            deposit.classList.add('history-none')
            myhistory.innerHTML = `
            <div class="col">Address</div>
            <div class="col">Amount</div>
            <div class="col">Currency</div>
            <div class="col">Status</div>
            <div class="col">Date</div>
            `

            thehistory.innerHTML = `<% if (withdrawals.length > 0) { %>
                                    <div class="container-fluid">
                                        <% withdrawals.forEach(withdrawal =>{ %>
                                            <div class="row text-center w-100 py-1">
                                                <div class="col text-nowrap overflow-x-auto"><b><%= withdrawal.address %> </b></div>
                                                <div class="col text-nowrap overflow-x-auto"><b>$<%= withdrawal.amount %> </b></div>
                                                <div class="col text-nowrap overflow-x-auto"><b><%= withdrawal.coin %> </b></div>
                                                <div class="col text-nowrap overflow-x-auto"> 
                                                    <% if (withdrawal.status == 'Pending'){%>
                                                        <b class="text-warning"><%= withdrawal.status %> </b>
                                                    <% }else{ %>
                                                        <b class="text-success"><%= withdrawal.status %> </b>
                                                    <% } %>
                                                </div>
                                                <div class="col text-nowrap overflow-x-auto"><b><%= withdrawal.date %> </b></div>
                                            </div>
                                        <% }) %> 
                                    </div>
                                <% } else { %>
                                    <div class="text-center">
                                        <p class="mb-0">No Transactions found.....</p>
                                    </div>
                                <% } %>
            `
        })
    </script>
</body>
</html>